<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>Cloud cost management - Melchi</title><meta name="Description" content="Cost Management for cloud infrastructure"><meta property="og:title" content="Cloud cost management" />
<meta property="og:description" content="Cost Management for cloud infrastructure" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://melchi.me/posts/cloud/" /><meta property="og:image" content="https://melchi.me/posts/cloud/gloomy-cloud.jpeg"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-07-27T11:14:32+10:00" />
<meta property="article:modified_time" content="2020-07-27T11:14:32+10:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://melchi.me/posts/cloud/gloomy-cloud.jpeg"/>
<meta name="twitter:title" content="Cloud cost management"/>
<meta name="twitter:description" content="Cost Management for cloud infrastructure"/>
<meta name="application-name" content="Melchi">
<meta name="apple-mobile-web-app-title" content="Melchi"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://melchi.me/posts/cloud/" /><link rel="next" href="https://melchi.me/posts/containers/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Cloud cost management",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/melchi.me\/posts\/cloud\/"
        },"image": [{
                            "@type": "ImageObject",
                            "url": "https:\/\/melchi.me\/posts\/cloud\/gloomy-cloud.jpeg",
                            "width":  700 ,
                            "height":  466 
                        }],"genre": "posts","keywords": "aws, gcp, cost","wordcount":  1033 ,
        "url": "https:\/\/melchi.me\/posts\/cloud\/","datePublished": "2020-07-27T11:14:32+10:00","dateModified": "2020-07-27T11:14:32+10:00","publisher": {
            "@type": "Organization",
            "name": "Melchi"},"author": {
                "@type": "Person",
                "name": "Melchi"
            },"description": "Cost Management for cloud infrastructure"
    }
    </script></head>
    <body data-header-desktop="auto" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Melchi"><span id="id-1" class="typeit"></span></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Melchi"><span id="id-2" class="typeit"></span></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">Cloud cost management</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>Melchi</a>
</span>&nbsp;<span class="post-category">included in <a href="/categories/cloud/"><i class="far fa-folder fa-fw"></i>cloud</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2020-07-27">2020-07-27</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;1033 words&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;5 minutes&nbsp;</div>
        </div><div class="featured-image"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/cloud/gloomy-cloud.jpeg"
        data-srcset="/posts/cloud/gloomy-cloud.jpeg, /posts/cloud/gloomy-cloud.jpeg 1.5x, /posts/cloud/gloomy-cloud.jpeg 2x"
        data-sizes="auto"
        alt="/posts/cloud/gloomy-cloud.jpeg"
        title="Cost Management for cloud infrastructure" /></div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#elasticity--the-double-edged-sword">Elasticity — The Double Edged Sword</a></li>
    <li><a href="#focusing-on-compute-as-a-starting-point">Focusing on compute as a starting point</a></li>
    <li><a href="#understanding-cost-to-usage-ratio">Understanding Cost to Usage Ratio</a></li>
    <li><a href="#leveraging-the-right-data-for-informed-insights">Leveraging the right data for informed insights</a></li>
    <li><a href="#always-on-elastic-infrastructure-is-the-future">Always on Elastic Infrastructure is the future</a></li>
    <li><a href="#understanding-the-power-of-kubernetes-bin-packing">Understanding the power of Kubernetes Bin Packing</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>About five years ago, Public Cloud services were not well understood. Large enterprises debated if migration to the cloud would meet their security requirements, paralyzed with the fear of the unknown. I have since come a long way — Digital Transformation is now synonymous with migration to the cloud. The benefits of on-demand infrastructure and elasticity have made engineers more productive and businesses happier with the promise of improved time-to-market.</p>
<p>Note: A key assumption being made in this write up is that your organisation has a considerable portion of applications that are stateless and can be subjected to horizontal scaling to make the most of cloud infrastructure. I will address optimising cost other workloads in another blog in this series.</p>
<h2 id="elasticity--the-double-edged-sword">Elasticity — The Double Edged Sword</h2>
<p>Public Cloud is a double-edged sword, especially when it comes to on-demand infrastructure and elasticity. Although spinning up resources and scaling out horizontally takes little effort, gracefully shutting down and draining connections to the same resources needs a more foresight and engineering rigour. If this is not done right, you could be racking up a hefty bill.</p>
<p>The pay as you go model of public cloud is not as straightforward either. Several services have a complex billing model where data retrieval is charged at a different rate than data storage of the same service, <a href="https://aws.amazon.com/xray/pricing/" target="_blank" rel="noopener noreffer">AWS X-Ray</a>
 is a good example one such a service. When X-Ray is used with other services such as AWS API Gateway and Lambda in a single solution, forecasting the spend gets a more complex.</p>
<h2 id="focusing-on-compute-as-a-starting-point">Focusing on compute as a starting point</h2>
<p>I have the privilege of working with several clients large and small who operate in domains varying from Finance, Utility to Gaming. I see the nuances of how their teams grow and adopt different technologies on their road to cloud adoption. However, irrespective of their domain there are always similarities in the way they utilise resources.</p>
<p>I&rsquo;ve observed that compute is generally the largest cloud cost. For example, the following figure shows the usage costs by service for four companies across different domains. I can see that compute is the biggest component of cost, with it contributing to 40% to 70% of the cost.</p>
<figure><img src="month-to-date-largest.png"/>
</figure>

<h2 id="understanding-cost-to-usage-ratio">Understanding Cost to Usage Ratio</h2>
<p>Public Cloud Vendors do a good job of breaking down usage by line item and show the trends of the billing cost. What they do not do, is a good job of highlighting the actual usage of service. For example in the EC2 line item from the images — all I see is how much I pay, not how much of that service is being used.</p>
<figure><img src="monthly-comparision-cost.png"/>
</figure>

<p>You need to dig deeper to get a better understanding of utilization. Cloud Watch on AWS and Stack Driver on GCP do a pretty good job at this.</p>
<h2 id="leveraging-the-right-data-for-informed-insights">Leveraging the right data for informed insights</h2>
<p>What you cannot measure you cannot optimize, and measuring the right metrics is even more important. To explore inefficiencies in compute utilization I can start with collecting CPU and RAM metrics. Cloudwatch allows easy plotting of CPU usage metrics.</p>
<figure><img src="CPU-utilization-3mo.png"/>
</figure>

<p><strong>Averages are misleading</strong> — When you look at data points on a very large scale, averages water down spiked sustained CPU usage. The above graph shows the average CPU utilization is about 7%. When you look at the P95 &amp; P99 of the same data you see a slightly different picture.</p>
<figure><img src="CPU-p95-3mo.png"/>
</figure>

<figure><img src="CPU-p99-3mo.png"/>
</figure>

<p><strong>Use percentiles instead</strong> — In the above two images you can see the CPU utilisation is around 16% and 22% respectively for the 95 and 99 percentile measurement, which is significantly higher than the average measurement. These two measurements paint a more accurate picture of the CPU load profile and the compute capacity you need to configure. It’s generally a good idea to have your elasticity desired state configure to P95, Average to Min &amp; P99 configured to Max.</p>
<p>The same metrics can be plotted for RAM as well — Most cloud service providers don’t let you do this out of the box due to limitations in the hypervisor. To enable memory metric collect on AWS checkout <a href="https://github.com/momenton/aws-memory-monitor" target="_blank" rel="noopener noreffer">repo</a>
</p>
<h2 id="always-on-elastic-infrastructure-is-the-future">Always on Elastic Infrastructure is the future</h2>
<p>It is a common practice to see organizations turn off their non-production infrastructure at nights or over the weekends. But with more organisations choosing to have geographically distributed teams working in different timezones, turning off infrastructure is not always feasible.</p>
<p>Also, it is important to ask yourself how many times you have walked into work on a Monday morning to discover that not all your infrastructure has booted as expected. Teams that move fast tend and update their infrastructure-as-code often and may encounter issues more frequently. Broken infrastructure reduces productivity drastically so this is another reason to leverage elasticity instead of turning off infrastructure. In our experience at Momenton, we’ve discovered more often than not the productivity loss from infrastructure issues outweigh the cost gain of turning off the infrastructure over the weekend.</p>
<p>An organisation that takes the approach of leaving their infrastructure always-on will enable their teams to work in multiple time-zones and flexible work hours. Kubernetes allows for clusters to scale from hundreds of nodes to just a couple without any manual intervention. Resource allocation can also be changed for all the containers in a matter of seconds with just a call to its API.</p>
<h2 id="understanding-the-power-of-kubernetes-bin-packing">Understanding the power of Kubernetes Bin Packing</h2>
<p>Once you have understood the compute requirement of your workload, you will need a platform that will allow for the optimisations of the use of your servers. This is where Kubernetes &amp; its Bin Packing feature comes in.</p>
<figure><img src="tetris.png"/>
</figure>

<p>Bin Packing works just like the game Tetris. Consider each of the pieces in the game to be application workloads. Kubernetes takes these containers workloads and places them on the same server for maximum utilisation of the resources. The security, resource utilization and isolation of these containers is also managed by Kubernetes but this is a topic for another blog post.</p>
<p>Kubernetes allows you to think of compute resources (CPU &amp; RAM) as a pool instead of different servers. This paradigm of approach allows to look at the entire compute requirement across the organisation and hand off the divvying of these resources to Kubernetes.</p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2020-07-27</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="https://melchi.me/posts/cloud/" data-title="Cloud cost management" data-via="@MelchiSalins" data-hashtags="aws,gcp,cost"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Linkedin" data-sharer="linkedin" data-url="https://melchi.me/posts/cloud/"><i class="fab fa-linkedin fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Hacker News" data-sharer="hackernews" data-url="https://melchi.me/posts/cloud/" data-title="Cloud cost management"><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/aws/">aws</a>,&nbsp;<a href="/tags/gcp/">gcp</a>,&nbsp;<a href="/tags/cost/">cost</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav">
            <a href="/posts/containers/" class="next" rel="next" title="Securing your CaaS using Google&#39;s gVisor">Securing your CaaS using Google&#39;s gVisor<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/lightgallery/lightgallery.min.css"><script type="text/javascript" src="https://polyfill.io/v3/polyfill.min.js?features=Array.prototype.fill%2CArray.prototype.find%2CArray.from%2CIntersectionObserver%2CMath.sign%2CObject.assign%2CPromise%2CObject.entries%2CElement.prototype.closest%2CrequestAnimationFrame%2CCustomEvent%2Chtml5shiv%2CObject.values%2Cfetch%2CElement.prototype.after"></script><script type="text/javascript" src="/lib/object-fit-images/ofi.min.js"></script><script type="text/javascript" src="/lib/smooth-scroll/smooth-scroll.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lightgallery.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lg-thumbnail.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lg-zoom.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/typeit/typeit.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":100},"comment":{},"data":{"id-1":"$~/","id-2":"$~/"},"lightGallery":{"actualSize":false,"exThumbImage":"data-thumbnail","hideBarsDelay":2000,"selector":".lightgallery","speed":400,"thumbContHeight":80,"thumbWidth":80,"thumbnail":true},"typeit":{"cursorChar":"|","cursorSpeed":1000,"data":{"id-1":["id-1"],"id-2":["id-2"]},"duration":-1,"speed":500}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
